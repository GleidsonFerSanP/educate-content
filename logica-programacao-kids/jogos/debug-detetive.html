<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ› Debug do Detetive</title>
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        .codigo-box {
            background: #2C3E50;
            color: #ECF0F1;
            padding: 30px;
            border-radius: 15px;
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            margin: 20px 0;
            line-height: 2;
        }
        
        .linha-codigo {
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .linha-codigo:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .linha-codigo.selecionada {
            background: #FF6B9D;
            border-color: #FFD93D;
        }
        
        .erro-icone {
            color: #FF6B9D;
            margin-right: 10px;
        }
        
        .dica-box {
            background: #FFF9C4;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #FFD93D;
        }
    </style>
</head>
<body>
    <a href="../index.html" class="btn-voltar">â† Voltar ao Menu</a>

    <div class="container">
        <div class="jogo-container">
            <h1 class="jogo-titulo">ğŸ› Debug do Detetive</h1>
            <p style="font-size: 1.3em; text-align: center;">
                Encontre o erro (bug) em cada cÃ³digo e conserte!
            </p>
            
            <div class="pontuacao">
                â­ Pontos: <span id="pontos">0</span> | 
                âœ… Acertos: <span id="acertos">0</span> | 
                Desafio: <span id="nivel">1</span>/5
            </div>

            <div id="feedback" class="feedback" style="display: none;"></div>

            <div class="jogo-area">
                <h3 style="color: #A960EE; margin-bottom: 20px;">
                    ğŸ•µï¸ MissÃ£o: <span id="missao"></span>
                </h3>
                
                <div class="dica-box">
                    <strong>ğŸ’¡ Dica:</strong> <span id="dica"></span>
                </div>
                
                <div id="codigo" class="codigo-box"></div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" onclick="verificarResposta()" id="btn-verificar">
                        âœ… Verificar Resposta
                    </button>
                    <button class="btn" onclick="proximoDesafio()" id="btn-proximo" style="display: none;">
                        â¡ï¸ PrÃ³ximo Desafio
                    </button>
                    <button class="btn" onclick="mostrarDica()" id="btn-dica">
                        ğŸ’¡ Ver Dica Extra
                    </button>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <a href="../topicos/debug.html" class="btn">ğŸ“š Rever o TÃ³pico</a>
                <a href="../index.html" class="btn">ğŸ  Menu Principal</a>
            </div>
        </div>
    </div>

    <script src="../js/main.js"></script>
    <script>
        const desafios = [
            {
                missao: "Fazer um sanduÃ­che",
                dica: "A ordem dos passos estÃ¡ correta?",
                dicaExtra: "O que vocÃª faz PRIMEIRO quando vai fazer um sanduÃ­che?",
                codigo: [
                    "1. Passar manteiga no pÃ£o",
                    "2. Colocar o recheio",
                    "3. Pegar duas fatias de pÃ£o",
                    "4. Fechar o sanduÃ­che"
                ],
                linhaErro: 0,
                explicacao: "VocÃª precisa PEGAR o pÃ£o ANTES de passar manteiga! A linha 3 deveria ser a primeira.",
                pontos: 10
            },
            {
                missao: "Plantar uma Ã¡rvore",
                dica: "VocÃª pode cobrir com terra antes de colocar a planta?",
                dicaExtra: "Pense na ordem: o que vai dentro do buraco primeiro?",
                codigo: [
                    "1. Cavar um buraco",
                    "2. Cobrir com terra",
                    "3. Colocar a muda no buraco",
                    "4. Regar com Ã¡gua"
                ],
                linhaErro: 1,
                explicacao: "VocÃª precisa COLOCAR A MUDA primeiro, DEPOIS cobrir com terra! As linhas 2 e 3 estÃ£o trocadas.",
                pontos: 15
            },
            {
                missao: "Fazer um bolo",
                dica: "VocÃª pode assar antes de misturar os ingredientes?",
                dicaExtra: "Qual Ã© a sequÃªncia correta: misturar ou assar primeiro?",
                codigo: [
                    "1. Pegar os ingredientes",
                    "2. Colocar no forno para assar",
                    "3. Misturar tudo",
                    "4. Retirar do forno"
                ],
                linhaErro: 1,
                explicacao: "VocÃª precisa MISTURAR os ingredientes ANTES de colocar no forno! As linhas 2 e 3 estÃ£o trocadas.",
                pontos: 15
            },
            {
                missao: "Atravessar a rua com seguranÃ§a",
                dica: "Qual passo estÃ¡ faltando ou errado?",
                dicaExtra: "O que vocÃª deve fazer ANTES de atravessar?",
                codigo: [
                    "1. Chegar na faixa de pedestres",
                    "2. Atravessar correndo",
                    "3. Olhar para os dois lados",
                    "4. Chegar do outro lado"
                ],
                linhaErro: 1,
                explicacao: "VocÃª precisa OLHAR para os dois lados ANTES de atravessar! As linhas 2 e 3 estÃ£o trocadas. SeguranÃ§a primeiro!",
                pontos: 20
            },
            {
                missao: "Jogar videogame",
                dica: "EstÃ¡ faltando um passo importante no inÃ­cio!",
                dicaExtra: "O que vocÃª precisa fazer ANTES de comeÃ§ar a jogar?",
                codigo: [
                    "1. Pegar o controle",
                    "2. ComeÃ§ar a jogar",
                    "3. Se divertir",
                    "4. Desligar o console"
                ],
                linhaErro: 1,
                explicacao: "VocÃª precisa LIGAR o console/videogame ANTES de comeÃ§ar a jogar! EstÃ¡ faltando esse passo entre as linhas 1 e 2.",
                pontos: 20
            }
        ];

        let nivelAtual = 0;
        let pontos = 0;
        let acertos = 0;
        let linhaSelecionada = null;

        function carregarDesafio() {
            if (nivelAtual >= desafios.length) {
                finalizarJogo();
                return;
            }

            const desafio = desafios[nivelAtual];
            document.getElementById('missao').textContent = desafio.missao;
            document.getElementById('dica').textContent = desafio.dica;
            document.getElementById('nivel').textContent = nivelAtual + 1;
            linhaSelecionada = null;

            const codigoDiv = document.getElementById('codigo');
            codigoDiv.innerHTML = '';

            desafio.codigo.forEach((linha, index) => {
                const linhaDiv = document.createElement('div');
                linhaDiv.className = 'linha-codigo';
                linhaDiv.textContent = linha;
                linhaDiv.dataset.index = index;
                linhaDiv.onclick = () => selecionarLinha(linhaDiv, index);
                codigoDiv.appendChild(linhaDiv);
            });

            document.getElementById('btn-proximo').style.display = 'none';
            document.getElementById('btn-verificar').style.display = 'inline-block';
            document.getElementById('btn-dica').style.display = 'inline-block';
            document.getElementById('feedback').style.display = 'none';
        }

        function selecionarLinha(elemento, index) {
            document.querySelectorAll('.linha-codigo').forEach(l => l.classList.remove('selecionada'));
            elemento.classList.add('selecionada');
            linhaSelecionada = index;
        }

        function verificarResposta() {
            if (linhaSelecionada === null) {
                alert('âŒ Selecione a linha que tem o erro primeiro!');
                return;
            }

            const desafio = desafios[nivelAtual];
            const feedback = document.getElementById('feedback');

            if (linhaSelecionada === desafio.linhaErro) {
                pontos += desafio.pontos;
                acertos++;
                mostrarFeedback(feedback, 
                    `ğŸ‰ ParabÃ©ns, detetive! VocÃª encontrou o bug! 
                    <br><br><strong>ExplicaÃ§Ã£o:</strong> ${desafio.explicacao}`, 
                    'correto'
                );
                document.getElementById('btn-proximo').style.display = 'inline-block';
                document.getElementById('btn-verificar').style.display = 'none';
            } else {
                mostrarFeedback(feedback, 
                    'âŒ NÃ£o Ã© essa linha! Leia com mais atenÃ§Ã£o e tente novamente.', 
                    'incorreto'
                );
            }

            document.getElementById('pontos').textContent = pontos;
            document.getElementById('acertos').textContent = acertos;
        }

        function mostrarDica() {
            const desafio = desafios[nivelAtual];
            alert(`ğŸ’¡ Dica Extra:\n\n${desafio.dicaExtra}`);
        }

        function proximoDesafio() {
            nivelAtual++;
            carregarDesafio();
        }

        function finalizarJogo() {
            const jogo = document.querySelector('.jogo-area');
            const taxa = ((acertos / desafios.length) * 100).toFixed(0);

            let mensagem = '';
            let emoji = '';

            if (taxa === '100') {
                mensagem = 'DETETIVE MESTRE! VocÃª encontrou todos os bugs!';
                emoji = 'ğŸ†';
                criarConfetes();
            } else if (taxa >= '80') {
                mensagem = 'DETETIVE EXPERIENTE! Excelente trabalho!';
                emoji = 'ğŸ•µï¸';
            } else if (taxa >= '60') {
                mensagem = 'DETETIVE INICIANTE! Continue praticando!';
                emoji = 'ğŸ”';
            } else {
                mensagem = 'APRENDIZ DE DETETIVE! NÃ£o desista!';
                emoji = 'ğŸ’ª';
            }

            jogo.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <h2 style="font-size: 3em;">${emoji}</h2>
                    <h2 style="color: #A960EE; margin: 20px 0;">${mensagem}</h2>
                    <p style="font-size: 1.5em; margin: 20px 0;">
                        Total de Pontos: <strong style="color: #6BCF7F;">${pontos}</strong>
                    </p>
                    <p style="font-size: 1.3em;">
                        Bugs Encontrados: <strong>${acertos}</strong> de <strong>${desafios.length}</strong>
                    </p>
                    <p style="font-size: 1.5em; margin: 20px 0;">
                        Taxa de Acerto: <strong style="color: #FF6B9D;">${taxa}%</strong>
                    </p>
                    <p style="font-size: 1.2em; margin-top: 30px;">
                        ğŸŠ Agora vocÃª Ã© um verdadeiro detetive de bugs! Continue praticando
                        e vocÃª vai ficar ainda melhor! ğŸ›ğŸ”
                    </p>
                    <button class="btn" onclick="location.reload()">ğŸ”„ Jogar Novamente</button>
                    <a href="../index.html" class="btn">ğŸ  Menu Principal</a>
                </div>
            `;

            salvarProgresso('debug-detetive', true);
        }

        window.addEventListener('load', carregarDesafio);
    </script>
</body>
</html>
